<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Vocabulary Sentence Quiz</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link
    href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Playfair+Display:wght@600;700&display=swap"
    rel="stylesheet"
  />

  <!-- Tailwind -->
  <link
    href="https://cdn.jsdelivr.net/npm/tailwindcss@3.4.1/dist/tailwind.min.css"
    rel="stylesheet"
  />

  <!-- Custom design layer -->
  <style>
    :root {
      color-scheme: dark;
    }

    body {
      font-family: "Inter", system-ui, -apple-system, BlinkMacSystemFont,
        "Segoe UI", sans-serif;
      background:
        radial-gradient(circle at top left, rgba(56, 189, 248, 0.18), transparent 55%),
        radial-gradient(circle at top right, rgba(129, 140, 248, 0.18), transparent 55%),
        radial-gradient(circle at bottom, rgba(34, 197, 94, 0.14), transparent 55%),
        #020617;
      min-height: 100vh;
    }

    .app-root-bg {
      backdrop-filter: blur(22px);
    }

    .glass-panel {
      background: radial-gradient(circle at top left, rgba(59, 130, 246, 0.12), transparent 45%),
        radial-gradient(circle at bottom right, rgba(16, 185, 129, 0.12), transparent 55%),
        rgba(15, 23, 42, 0.96);
      border-radius: 26px;
      border: 1px solid rgba(148, 163, 184, 0.45);
      box-shadow:
        0 24px 80px rgba(15, 23, 42, 0.95),
        0 0 0 1px rgba(15, 23, 42, 0.8);
    }

    .app-gradient-title {
      font-family: "Playfair Display", "Inter", system-ui, sans-serif;
      background: linear-gradient(90deg, #3b82f6, #6366f1, #22c55e);
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
      letter-spacing: 0.02em;
    }

    .app-title-underline {
      width: 90px;
      height: 5px;
      border-radius: 999px;
      margin: 6px auto 0;
      background: linear-gradient(90deg, #3b82f6, #22c55e);
      box-shadow: 0 0 20px rgba(59, 130, 246, 0.6);
    }

    .sidebar {
      background: #020617;
      border-radius: 22px;
      border: 1px solid rgba(15, 23, 42, 0.95);
      box-shadow:
        0 18px 50px rgba(15, 23, 42, 1),
        0 0 0 1px rgba(15, 23, 42, 0.9);
    }

    .sidebar-section-title {
      font-size: 0.7rem;
      letter-spacing: 0.08em;
      text-transform: uppercase;
      color: #9ca3af;
    }

    .nav-item {
      border-radius: 999px;
      padding: 0.55rem 0.95rem;
      font-size: 0.9rem;
      display: flex;
      align-items: center;
      gap: 0.6rem;
      cursor: pointer;
      transition: all 0.15s ease-out;
    }

    .nav-item-icon {
      font-size: 1.1rem;
    }

    .nav-item-active {
      background: radial-gradient(circle at left, rgba(59, 130, 246, 0.55), transparent 55%),
        rgba(15, 23, 42, 1);
      color: #f9fafb;
      box-shadow: 0 12px 30px rgba(37, 99, 235, 0.9);
      border: 1px solid rgba(191, 219, 254, 0.9);
    }

    .nav-item-inactive {
      color: #e5e7eb;
      border: 1px solid rgba(55, 65, 81, 0.9);
      background: rgba(15, 23, 42, 0.96);
    }

    .nav-item-inactive:hover {
      background: rgba(30, 64, 175, 0.4);
      transform: translateY(-1px);
    }

    .deck-card {
      background: rgba(15, 23, 42, 0.98);
      border-radius: 12px;
      border: 1px solid rgba(75, 85, 99, 0.95);
      box-shadow: 0 16px 40px rgba(15, 23, 42, 0.9);
      transition: all 0.18s ease-out;
    }

    .deck-card:hover {
      transform: translateY(-3px) scale(1.01);
      box-shadow: 0 18px 50px rgba(37, 99, 235, 0.75);
      border-color: rgba(129, 140, 248, 0.95);
    }

    .deck-create-card {
      border-radius: 12px;
      border: 2px dashed rgba(148, 163, 184, 0.8);
      background: rgba(15, 23, 42, 0.9);
      box-shadow: 0 10px 26px rgba(15, 23, 42, 0.85);
      transition: all 0.18s ease-out;
    }

    .deck-create-card:hover {
      border-color: rgba(56, 189, 248, 0.9);
      background: rgba(15, 23, 42, 1);
      transform: translateY(-3px) scale(1.01);
      box-shadow: 0 18px 46px rgba(56, 189, 248, 0.5);
    }

    .sync-card {
      background: radial-gradient(circle at top left, rgba(59, 130, 246, 0.18), transparent 55%),
        rgba(15, 23, 42, 0.96);
      border-radius: 18px;
      border: 1px solid rgba(148, 163, 184, 0.55);
      box-shadow: 0 18px 50px rgba(15, 23, 42, 0.85);
    }

    .sync-input {
      border-radius: 999px;
      background: #020617;
      border: 1px solid rgba(148, 163, 184, 0.8);
      box-shadow: 0 0 0 1px rgba(15, 23, 42, 0.9);
    }

    .sync-pill-btn {
      border-radius: 999px;
      padding: 0.6rem 1.1rem;
      font-size: 0.8rem;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 0.35rem;
      transition: all 0.16s ease-out;
      white-space: nowrap;
    }

    .sync-pill-btn:hover {
      transform: translateY(-1px);
    }

    .primary-btn {
      background: linear-gradient(135deg, #3b82f6, #6366f1);
      color: #f9fafb;
      box-shadow: 0 12px 28px rgba(59, 130, 246, 0.8);
      border: none;
    }

    .primary-btn:hover {
      filter: brightness(1.05);
      box-shadow: 0 16px 40px rgba(79, 70, 229, 0.9);
    }

    .outline-success {
      border: 1px solid #22c55e;
      color: #bbf7d0;
      background: rgba(6, 95, 70, 0.15);
    }

    .outline-success:hover {
      background: rgba(34, 197, 94, 0.2);
      box-shadow: 0 12px 32px rgba(22, 163, 74, 0.5);
    }

    .import-card,
    .list-card {
      background: rgba(15, 23, 42, 0.96);
      border-radius: 18px;
      border: 1px solid rgba(55, 65, 81, 0.95);
      box-shadow: 0 16px 48px rgba(15, 23, 42, 0.85);
    }

    .code-box {
      background: rgba(15, 23, 42, 0.96);
      border-radius: 14px;
      border: 1px solid rgba(75, 85, 99, 0.9);
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas,
        "Liberation Mono", "Courier New", monospace;
    }

    .quiz-card {
      background: radial-gradient(circle at top, rgba(59, 130, 246, 0.2), transparent 60%),
        rgba(15, 23, 42, 0.98);
      border-radius: 24px;
      border: 1px solid rgba(75, 85, 99, 0.95);
      box-shadow: 0 28px 80px rgba(15, 23, 42, 1);
    }

    .blank-chip {
      display: inline-block;
      padding: 0.25rem 0.8rem;
      border-radius: 999px;
      border: 1px solid rgba(59, 130, 246, 0.85);
      box-shadow: 0 0 22px rgba(59, 130, 246, 0.7);
      background: rgba(15, 23, 42, 0.98);
      margin-inline: 0.2rem;
    }

    .option-button {
      position: relative;
      overflow: hidden;
      backdrop-filter: blur(18px);
    }

    .option-button::before {
      content: "";
      position: absolute;
      inset: 0;
      opacity: 0;
      background: radial-gradient(circle at top, rgba(129, 140, 248, 0.2), transparent 60%);
      transition: opacity 0.2s ease-out;
      pointer-events: none;
    }

    .option-button:hover::before {
      opacity: 1;
    }

    .option-correct {
      border-color: #22c55e !important;
      background: rgba(22, 163, 74, 0.25) !important;
      box-shadow: 0 0 26px rgba(34, 197, 94, 0.75);
    }

    @keyframes shake {
      10%, 90% { transform: translateX(-1px); }
      20%, 80% { transform: translateX(2px); }
      30%, 50%, 70% { transform: translateX(-4px); }
      40%, 60% { transform: translateX(4px); }
    }

    .option-wrong {
      border-color: #ef4444 !important;
      background: rgba(127, 29, 29, 0.28) !important;
      animation: shake 0.22s ease-in-out;
      box-shadow: 0 0 26px rgba(248, 113, 113, 0.9);
    }

    .nav-pill {
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.85);
      padding: 0.6rem 1.1rem;
      font-size: 0.85rem;
      transition: all 0.15s ease-out;
    }

    .nav-pill:hover {
      background: rgba(148, 163, 184, 0.18);
      transform: translateY(-1px);
    }

    .empty-state {
      border-radius: 18px;
      border: 1px dashed rgba(148, 163, 184, 0.6);
      background: rgba(15, 23, 42, 0.9);
      padding: 1.5rem 1.2rem;
      text-align: center;
    }

    .page-fade {
      transition: opacity 0.18s ease-out, transform 0.18s ease-out;
    }

    .page-hidden {
      opacity: 0;
      transform: translateY(4px);
      pointer-events: none;
      position: absolute;
      inset: 0;
    }

    .page-visible {
      opacity: 1;
      transform: translateY(0);
      position: relative;
    }
  </style>
</head>
<body class="text-slate-100 text-base">
  <div id="root"></div>

  <!-- React + ReactDOM + Babel -->
  <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <!-- XLSX -->
  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>

  <script type="text/babel">
    const { useState, useEffect } = React;

    const API_BASE = "https://vocab-backend-lbum.onrender.com";

    if ("speechSynthesis" in window) {
      window.speechSynthesis.onvoiceschanged = () => {};
    }

    function shuffleArray(array) {
      const arr = [...array];
      for (let i = arr.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [arr[i], arr[j]] = [arr[j], arr[i]];
      }
      return arr;
    }

    function parseManualText(raw) {
      return raw
        .split(/\n/)
        .map((line) => line.trim())
        .filter(Boolean)
        .map((line, index) => {
          const parts = line.split(/\t/);
          const sentence = parts[0] ? String(parts[0]).trim() : "";
          const word = parts[1] ? String(parts[1]).trim() : "";
          const translation = parts[2] ? String(parts[2]).trim() : "";

          return {
            id: `manual-${Date.now()}-${index}`,
            sentence,
            word,
            translation,
          };
        })
        .filter((c) => c.sentence && c.word);
    }

    function speakWord(word) {
      if (!("speechSynthesis" in window)) {
        alert("Your browser does not support text-to-speech.");
        return;
      }

      const utter = new SpeechSynthesisUtterance(word);
      const voices = window.speechSynthesis.getVoices() || [];
      const preferred = voices.find(
        (v) =>
          v.name.toLowerCase().includes("samantha") ||
          v.name.toLowerCase().includes("google us")
      );
      if (preferred) {
        utter.voice = preferred;
      }

      utter.lang = "en-US";
      window.speechSynthesis.cancel();
      window.speechSynthesis.speak(utter);
    }

    function App() {
      const [decks, setDecks] = useState(() => {
        if (typeof window !== "undefined") {
          try {
            const saved = window.localStorage.getItem("vq_decks_v1");
            if (saved) {
              const parsed = JSON.parse(saved);
              if (Array.isArray(parsed) && parsed.length) {
                return parsed;
              }
            }
          } catch (e) {
            console.warn("Failed to load decks from storage", e);
          }
        }
        return [{ id: "deck-1", name: "Default deck", cards: [] }];
      });

      const [activeDeckId, setActiveDeckId] = useState("deck-1");
      const [manualText, setManualText] = useState("");
      const [practiceIndex, setPracticeIndex] = useState(0);
      const [options, setOptions] = useState([]);
      const [selectedOptionId, setSelectedOptionId] = useState(null);
      const [feedback, setFeedback] = useState("");
      const [revealed, setRevealed] = useState(false);

      const [syncId, setSyncId] = useState("");
      const [cloudStatus, setCloudStatus] = useState("");

      // pages: "dashboard" | "import" | "practice" | "cloud"
      const [page, setPage] = useState("dashboard");

      const activeDeck =
        decks.find((d) => d.id === activeDeckId) || decks[0];
      const cards = activeDeck ? activeDeck.cards : [];
      const hasCards = cards.length > 0;
      const currentCard = hasCards ? cards[practiceIndex] : null;

      useEffect(() => {
        try {
          window.localStorage.setItem("vq_decks_v1", JSON.stringify(decks));
        } catch (e) {
          console.warn("Failed to save decks to storage", e);
        }
      }, [decks]);

      useEffect(() => {
        if (!hasCards || !currentCard) {
          setOptions([]);
          return;
        }

        const others = cards.filter((c, idx) => idx !== practiceIndex);
        const distractors = shuffleArray(others).slice(
          0,
          Math.min(3, others.length)
        );
        const combined = shuffleArray([currentCard, ...distractors]);

        setOptions(combined);
        setSelectedOptionId(null);
        setFeedback("");
        setRevealed(false);
      }, [cards, practiceIndex, hasCards, currentCard]);

      const resetPractice = () => {
        setPracticeIndex(0);
        setSelectedOptionId(null);
        setFeedback("");
        setRevealed(false);
      };

      const replaceCardsInActiveDeck = (newCards) => {
        setDecks((prev) =>
          prev.map((deck) =>
            deck.id === activeDeckId ? { ...deck, cards: newCards } : deck
          )
        );
        resetPractice();
      };

      const handleFileUpload = (e) => {
        const file = e.target.files?.[0];
        if (!file) return;

        const reader = new FileReader();
        reader.onload = (evt) => {
          const data = new Uint8Array(evt.target.result);
          const workbook = XLSX.read(data, { type: "array" });
          const firstSheetName = workbook.SheetNames[0];
          const sheet = workbook.Sheets[firstSheetName];
          const rows = XLSX.utils.sheet_to_json(sheet, { header: 1 });

          const newCards = rows
            .filter((row) => row && row[0] && row[1])
            .map((row, index) => {
              const sentence = String(row[0]).trim();
              const word = String(row[1]).trim();
              const translation = row[2] ? String(row[2]).trim() : "";

              return {
                id: `excel-${Date.now()}-${index}`,
                sentence,
                word,
                translation,
              };
            })
            .filter((c) => c.sentence && c.word);

          if (newCards.length) {
            replaceCardsInActiveDeck(newCards);
          }
        };

        reader.readAsArrayBuffer(file);
      };

      const handleUseManualText = () => {
        const parsed = parseManualText(manualText);
        if (parsed.length) {
          replaceCardsInActiveDeck(parsed);
        }
      };

      const handlePrev = () => {
        if (!hasCards) return;
        setPracticeIndex((prev) =>
          prev - 1 < 0 ? cards.length - 1 : prev - 1
        );
      };

      const handleNext = () => {
        if (!hasCards) return;
        setPracticeIndex((prev) => (prev + 1) % cards.length);
      };

      const handleChooseOption = (optionId) => {
        if (!currentCard || !options.length) return;
        const chosen = options.find((o) => o.id === optionId);
        if (!chosen) return;

        setSelectedOptionId(optionId);
        setRevealed(true);

        if (
          chosen.word.trim().toLowerCase() ===
          currentCard.word.trim().toLowerCase()
        ) {
          setFeedback("Correct! üéâ");
        } else {
          setFeedback(
            `Not quite. The correct word is "${currentCard.word}".`
          );
        }
      };

      const handleDeleteCard = (cardId) => {
        setDecks((prev) =>
          prev.map((deck) =>
            deck.id === activeDeckId
              ? {
                  ...deck,
                  cards: deck.cards.filter((c) => c.id !== cardId),
                }
              : deck
          )
        );
        resetPractice();
      };

      const handleAddDeck = () => {
        const name = prompt(
          "New deck name (e.g. Book A, Work, Movies‚Ä¶):"
        );
        if (!name || !name.trim()) return;
        const id = `deck-${Date.now()}`;
        const newDeck = { id, name: name.trim(), cards: [] };
        setDecks((prev) => [...prev, newDeck]);
        setActiveDeckId(id);
        resetPractice();
      };

      const handleDeleteDeck = (deckId) => {
        if (decks.length === 1) {
          alert("You must keep at least one deck.");
          return;
        }
        const deck = decks.find((d) => d.id === deckId);
        const ok = confirm(
          `Delete deck "${deck?.name}" and all its sentences?`
        );
        if (!ok) return;

        setDecks((prev) => prev.filter((d) => d.id !== deckId));
        if (activeDeckId === deckId) {
          const remaining = decks.filter((d) => d.id !== deckId);
          if (remaining.length > 0) {
            setActiveDeckId(remaining[0].id);
          }
        }
        resetPractice();
      };

      const handleCloudSave = async () => {
        if (!syncId.trim()) {
          alert("Please enter a Sync ID first.");
          return;
        }
        if (!API_BASE || API_BASE.includes("YOUR-BACKEND-URL")) {
          alert("API_BASE is not configured.");
          return;
        }

        try {
          setCloudStatus("Saving to cloud‚Ä¶");
          const res = await fetch(
            `${API_BASE}/decks/${encodeURIComponent(syncId.trim())}`,
            {
              method: "PUT",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify({ decks }),
            }
          );
          if (!res.ok) {
            throw new Error("Bad response");
          }
          setCloudStatus("Saved to cloud ‚úÖ");
        } catch (e) {
          console.error(e);
          setCloudStatus("Error while saving ‚ùå");
        }
      };

      const handleCloudLoad = async () => {
        if (!syncId.trim()) {
          alert("Please enter a Sync ID first.");
          return;
        }
        if (!API_BASE || API_BASE.includes("YOUR-BACKEND-URL")) {
          alert("API_BASE is not configured.");
          return;
        }

        try {
          setCloudStatus("Loading from cloud‚Ä¶");
          const res = await fetch(
            `${API_BASE}/decks/${encodeURIComponent(syncId.trim())}`
          );
          if (res.status === 404) {
            setCloudStatus("No data found for this Sync ID.");
            return;
          }
          if (!res.ok) {
            throw new Error("Bad response");
          }
          const data = await res.json();
          if (!data.decks || !Array.isArray(data.decks)) {
            throw new Error("Invalid data");
          }
          setDecks(data.decks);
          if (data.decks.length > 0) {
            setActiveDeckId(data.decks[0].id || "deck-1");
          }
          setPracticeIndex(0);
          setSelectedOptionId(null);
          setFeedback("");
          setRevealed(false);
          setCloudStatus("Loaded from cloud ‚úÖ");
        } catch (e) {
          console.error(e);
          setCloudStatus("Error while loading ‚ùå");
        }
      };

      // ---------- PAGES ----------

      const renderDashboardPage = () => (
        <div
          className={
            "page-fade " +
            (page === "dashboard" ? "page-visible" : "page-hidden")
          }
        >
          <p className="text-base text-slate-200 mb-4 text-center">
            Choose a deck to practice, or create a new one.  
            Each deck can be a book, course, TV show, or topic.
          </p>

          {decks.length === 0 ? (
            <div className="empty-state text-base text-slate-200">
              No decks yet. Create your first deck to get started.
            </div>
          ) : (
            <div className="grid gap-4 sm:grid-cols-2 lg:grid-cols-3 mt-4">
              {decks.map((deck) => (
                <button
                  key={deck.id}
                  onClick={() => {
                    setActiveDeckId(deck.id);
                    resetPractice();
                    setPage("practice");
                  }}
                  className={
                    "deck-card w-full text-left px-4 py-4 flex flex-col justify-between " +
                    (deck.id === activeDeckId ? "ring-2 ring-sky-400" : "")
                  }
                >
                  <div className="flex items-start justify-between mb-3">
                    <h3 className="text-lg font-semibold text-slate-50">
                      {deck.name}
                    </h3>
                    <span className="px-2 py-0.5 rounded-full text-xs bg-slate-800 text-slate-200 border border-slate-600">
                      {deck.cards.length} cards
                    </span>
                  </div>
                  <p className="text-xs text-slate-400 mb-3">
                    Practice sentences and words from this deck.
                  </p>
                  <div className="flex items-center justify-between text-xs text-slate-300">
                    <span className="inline-flex items-center gap-1">
                      <span className="text-sky-400">‚ñ∂</span>
                      <span>Start practice</span>
                    </span>
                    {deck.id === activeDeckId && (
                      <span className="text-[10px] text-emerald-300">
                        Active deck
                      </span>
                    )}
                  </div>
                </button>
              ))}

              {/* Create new deck card */}
              <button
                onClick={handleAddDeck}
                className="deck-create-card w-full flex flex-col items-center justify-center px-4 py-6 text-center"
              >
                <div className="text-3xl mb-2 text-sky-400">Ôºã</div>
                <div className="text-base font-medium text-slate-100">
                  Create new deck
                </div>
                <div className="text-xs text-slate-400 mt-1">
                  Organize your vocab by book, topic, or exam.
                </div>
              </button>
            </div>
          )}
        </div>
      );

      const renderImportPage = () => (
        <div
          className={
            "page-fade " +
            (page === "import" ? "page-visible" : "page-hidden")
          }
        >
          <p className="text-base text-slate-200 mb-4 text-center">
            Import sentences with a missing word, then build quizzes for the
            active deck:{" "}
            <span className="font-semibold text-sky-300">
              {activeDeck?.name || ""}
            </span>
          </p>

          <div className="grid md:grid-cols-[1.25fr,1fr] gap-6">
            {/* Import */}
            <section className="space-y-3 import-card p-4">
              <h2 className="text-xl font-semibold flex items-center gap-2">
                <span className="text-sky-400 text-xl">‚¨á</span>
                <span>Import into: {activeDeck?.name || ""}</span>
              </h2>
              <p className="text-xs text-slate-300 leading-relaxed">
                Excel / CSV structure:
                <br />
                <span className="font-mono">
                  A: Sentence with ____ (one blank)
                </span>
                <br />
                <span className="font-mono">B: English word</span>
                <br />
                <span className="font-mono">
                  C: Translation (your language)
                </span>
              </p>
              <input
                type="file"
                accept=".xlsx,.xls,.csv"
                onChange={handleFileUpload}
                className="w-full text-xs text-slate-200 file:mr-3 file:px-4 file:py-2 file:rounded-full file:border-0 file:bg-gradient-to-r file:from-sky-500 file:to-indigo-500 file:text-white hover:file:from-sky-400 hover:file:to-indigo-400 file:shadow-lg file:shadow-sky-700/40"
              />
              <p className="text-xs text-slate-400">
                Or paste manually: one line per sentence in this format:
                <br />
                <span className="font-mono">
                  Sentence[TAB]Word[TAB]Translation
                </span>
              </p>

              <pre className="code-box text-[11px] px-3 py-2 text-slate-200 whitespace-pre-wrap">
I bought a new ____ yesterday.	car	car (translation)
The firefighter was very ____ today.	brave	◊ê◊û◊ô◊•
              </pre>
              <textarea
                className="w-full h-32 rounded-xl bg-slate-950 border border-slate-700 px-3 py-2 text-sm outline-none focus:border-sky-500 focus:ring-1 focus:ring-sky-500/60"
                placeholder={`I bought a new ____ yesterday.\tcar\tcar (translation)`}
                value={manualText}
                onChange={(e) => setManualText(e.target.value)}
              />
              <button
                onClick={handleUseManualText}
                className="w-full inline-flex items-center justify-center rounded-full bg-gradient-to-r from-sky-500 to-indigo-500 hover:from-sky-400 hover:to-indigo-400 text-sm font-medium px-4 py-2 transition disabled:opacity-40 shadow-lg shadow-sky-800/60"
                disabled={!manualText.trim()}
              >
                Replace / add sentences from text
              </button>
            </section>

            {/* Sentence list */}
            <section className="space-y-3 list-card p-4">
              <div className="flex items-center justify-between">
                <h2 className="text-xl font-semibold flex items-center gap-2">
                  <span className="text-emerald-400 text-xl">üìÑ</span>
                  <span>Sentences in this deck</span>
                </h2>
                <span className="text-xs text-slate-400">
                  {cards.length} sentences
                </span>
              </div>

              {cards.length === 0 ? (
                <div className="empty-state text-sm text-slate-300">
                  No sentences yet. Import a file or paste text to start
                  building your deck.
                </div>
              ) : (
                <div className="space-y-2 max-h-72 overflow-y-auto pr-2">
                  {cards.map((card) => (
                    <div
                      key={card.id}
                      className="flex flex-col gap-1 border border-slate-700 rounded-xl px-3 py-2 bg-slate-900/70 text-xs shadow-sm shadow-slate-900/80"
                    >
                      <div className="text-[11px] text-slate-400">
                        Sentence:
                      </div>
                      <div className="text-slate-100 text-sm">
                        {card.sentence}
                      </div>
                      <div className="flex items-center justify-between mt-1">
                        <div>
                          <span className="font-semibold text-sky-300 text-sm">
                            {card.word}
                          </span>
                          {card.translation && (
                            <span className="ml-2 text-slate-300 text-xs">
                              ({card.translation})
                            </span>
                          )}
                        </div>
                        <div className="flex items-center gap-2">
                          <button
                            onClick={() => speakWord(card.word)}
                            className="text-[11px] px-2 py-1 rounded-full border border-slate-600 hover:bg-slate-700"
                            title="Play word in English"
                          >
                            üîä
                          </button>
                          <button
                            onClick={() => handleDeleteCard(card.id)}
                            className="text-[11px] px-2 py-1 rounded-full border border-red-500 text-red-300 hover:bg-red-500/20"
                          >
                            üóë
                          </button>
                        </div>
                      </div>
                    </div>
                  ))}
                </div>
              )}
            </section>
          </div>
        </div>
      );

      const renderPracticePage = () => (
        <div
          className={
            "page-fade " +
            (page === "practice" ? "page-visible" : "page-hidden")
          }
        >
          {!currentCard ? (
            <div className="empty-state text-base text-slate-200">
              There are no sentences to practice in this deck yet.  
              Go to <span className="font-semibold">Import</span> and load
              some sentences first.
            </div>
          ) : (
            <div className="flex items-center justify-center min-h-[360px]">
              <div className="quiz-card w-full max-w-2xl px-6 py-6 flex flex-col items-center text-center">
                <p className="text-sm text-slate-300 mb-2">
                  Choose the correct word to complete the sentence.
                </p>

                {/* Sentence */}
                <div className="mb-5">
                  <p className="text-2xl md:text-3xl font-semibold text-sky-50 leading-relaxed">
                    {currentCard.sentence
                      .replace("____", "<BLANK>")
                      .split("<BLANK>")
                      .map((part, idx, arr) => (
                        <>
                          {part}
                          {idx < arr.length - 1 && (
                            <span className="blank-chip text-lg">
                              ____
                            </span>
                          )}
                        </>
                      ))}
                  </p>
                </div>

                {/* Answers grid 2x2 */}
                <div className="grid grid-cols-1 sm:grid-cols-2 gap-3 w-full">
                  {options.map((opt) => {
                    const isCorrect =
                      opt.word.trim().toLowerCase() ===
                      currentCard.word.trim().toLowerCase();
                    const isSelected = selectedOptionId === opt.id;
                    const isWrongSelected =
                      revealed && isSelected && !isCorrect;

                    return (
                      <button
                        key={opt.id}
                        onClick={() => handleChooseOption(opt.id)}
                        className={
                          "option-button text-center rounded-xl border px-4 py-3 text-lg transition " +
                          (isSelected
                            ? "border-sky-400 bg-slate-800"
                            : "border-slate-600 bg-slate-800/80 hover:bg-slate-700") +
                          " " +
                          (revealed && isCorrect ? "option-correct" : "") +
                          " " +
                          (isWrongSelected ? "option-wrong" : "")
                        }
                      >
                        <div className="flex items-center justify-center gap-2">
                          <span className="font-semibold text-slate-50">
                            {opt.word}
                          </span>
                          <button
                            type="button"
                            onClick={(e) => {
                              e.stopPropagation();
                              speakWord(opt.word);
                            }}
                            className="text-[11px] px-2 py-1 rounded-full border border-slate-500 hover:bg-slate-700"
                            title="Play word in English"
                          >
                            üîä
                          </button>
                        </div>
                      </button>
                    );
                  })}
                </div>

                {/* Toast feedback */}
                {(feedback || (revealed && currentCard.translation)) && (
                  <div
                    className={
                      "mt-5 w-full rounded-xl px-4 py-3 text-sm font-medium " +
                      (feedback.startsWith("Correct")
                        ? "bg-emerald-600/90 text-emerald-50"
                        : "bg-red-600/90 text-red-50")
                    }
                  >
                    <div>{feedback}</div>
                    {revealed && currentCard.translation && (
                      <div className="text-xs mt-1 opacity-90">
                        Translation:{" "}
                        <span className="font-semibold">
                          {currentCard.translation}
                        </span>
                      </div>
                    )}
                  </div>
                )}

                {/* Navigation */}
                <div className="flex items-center justify-between mt-5 w-full">
                  <div className="flex gap-2">
                    <button
                      onClick={handlePrev}
                      className="nav-pill text-slate-100"
                    >
                      ‚óÄ Previous
                    </button>
                    <button
                      onClick={handleNext}
                      className="nav-pill text-slate-100"
                    >
                      Next ‚ñ∂
                    </button>
                  </div>

                  <button
                    onClick={() => setPage("dashboard")}
                    className="text-xs text-sky-300 hover:underline"
                  >
                    Back to decks
                  </button>
                </div>
              </div>
            </div>
          )}
        </div>
      );

      const renderCloudPage = () => (
        <div
          className={
            "page-fade " +
            (page === "cloud" ? "page-visible" : "page-hidden")
          }
        >
          <p className="text-base text-slate-200 mb-4 text-center">
            Use cloud sync to move your decks between devices.  
            Use the same <span className="font-semibold">Sync ID</span> on
            laptop, phone, or tablet.
          </p>

          <section className="sync-card p-5 flex flex-col md:flex-row gap-4 md:items-center md:justify-between">
            <div className="flex-1 flex flex-col gap-1">
              <div className="flex items-center gap-2 text-sm text-slate-200">
                <span className="text-xl">‚òÅÔ∏è</span>
                <span>
                  Sync ID (use the same ID on every device to share your decks):
                </span>
              </div>
              <input
                type="text"
                value={syncId}
                onChange={(e) => setSyncId(e.target.value)}
                placeholder="For example: shlomi-english"
                className="sync-input px-3 py-2 text-sm outline-none focus:border-sky-500 mt-2"
              />
              {cloudStatus && (
                <span className="text-[11px] text-slate-200 mt-1">
                  {cloudStatus}
                </span>
              )}
            </div>
            <div className="flex gap-2 md:flex-col">
              <button
                onClick={handleCloudSave}
                className="sync-pill-btn primary-btn"
              >
                ‚òÅÔ∏è Save to cloud
              </button>
              <button
                onClick={handleCloudLoad}
                className="sync-pill-btn outline-success"
              >
                ‚òÅÔ∏è Load from cloud
              </button>
            </div>
          </section>
        </div>
      );

      const pageTitle =
        page === "dashboard"
          ? "Decks Dashboard"
          : page === "import"
          ? "Import & Edit"
          : page === "practice"
          ? "Quiz Mode"
          : "Cloud Sync";

      const pageSubtitle =
        page === "dashboard"
          ? "See all your decks at a glance and jump into practice with one click."
          : page === "import"
          ? "Build your sentence decks by importing files or pasting text."
          : page === "practice"
          ? "Focus mode: one sentence, four options, instant feedback."
          : "Move your decks between devices in just two clicks.";

      return (
        <div className="min-h-screen flex bg-slate-950 app-root-bg">
          {/* Sidebar (App Shell) */}
          <aside className="hidden md:flex flex-col w-[260px] m-4 sidebar p-4 gap-6">
            <div>
              <div className="flex items-center gap-2 mb-2">
                <div className="h-9 w-9 rounded-2xl bg-gradient-to-br from-sky-500 to-emerald-400 flex items-center justify-center text-2xl">
                  üìö
                </div>
                <div>
                  <div className="text-xs text-slate-400">
                    Personal English Lab
                  </div>
                  <div className="text-sm font-semibold text-slate-50">
                    Vocab Sentence Quiz
                  </div>
                </div>
              </div>
              <p className="text-[11px] text-slate-500 leading-snug">
                Import sentences, practice in context, and sync your decks.
              </p>
            </div>

            <div className="flex flex-col gap-5 flex-1">
              {/* Pages */}
              <div>
                <div className="sidebar-section-title mb-2">
                  PAGES
                </div>
                <div className="flex flex-col gap-2">
                  <button
                    className={
                      "nav-item " +
                      (page === "dashboard"
                        ? "nav-item-active"
                        : "nav-item-inactive")
                    }
                    onClick={() => setPage("dashboard")}
                  >
                    <span className="nav-item-icon">üè†</span>
                    <span>Decks dashboard</span>
                  </button>
                  <button
                    className={
                      "nav-item " +
                      (page === "import"
                        ? "nav-item-active"
                        : "nav-item-inactive")
                    }
                    onClick={() => setPage("import")}
                  >
                    <span className="nav-item-icon">üì•</span>
                    <span>Import & edit</span>
                  </button>
                  <button
                    className={
                      "nav-item " +
                      (page === "practice"
                        ? "nav-item-active"
                        : "nav-item-inactive")
                    }
                    onClick={() => setPage("practice")}
                  >
                    <span className="nav-item-icon">üéØ</span>
                    <span>Quiz mode</span>
                  </button>
                  <button
                    className={
                      "nav-item " +
                      (page === "cloud"
                        ? "nav-item-active"
                        : "nav-item-inactive")
                    }
                    onClick={() => setPage("cloud")}
                  >
                    <span className="nav-item-icon">‚òÅÔ∏è</span>
                    <span>Cloud sync</span>
                  </button>
                </div>
              </div>

              {/* Active deck info */}
              <div>
                <div className="sidebar-section-title mb-2">
                  ACTIVE DECK
                </div>
                <div className="deck-card px-3 py-3">
                  <div className="flex items-center justify-between mb-1">
                    <div className="flex items-center gap-2">
                      <span className="text-[14px]">üìÇ</span>
                      <span className="text-sm font-semibold text-slate-50">
                        {activeDeck?.name}
                      </span>
                    </div>
                    <span className="text-[11px] text-slate-300">
                      {cards.length} cards
                    </span>
                  </div>
                  <p className="text-[11px] text-slate-400">
                    Use the dashboard to switch decks or create a new one.
                  </p>
                </div>
              </div>
            </div>

            <div className="text-[10px] text-slate-500">
              Tip: create one deck per book / course / TV show.  
              Decks + Sync ID = your personal learning system üåç
            </div>
          </aside>

          {/* Main content */}
          <main className="flex-1 m-4 glass-panel p-6 md:p-8 relative overflow-hidden">
            {/* Header */}
            <header className="flex flex-col items-center text-center mb-8">
              <h1 className="app-gradient-title text-3xl md:text-4xl font-semibold mb-1">
                Vocabulary Sentence Quiz
              </h1>
              <div className="app-title-underline" />
              <p className="mt-4 text-sm md:text-base text-slate-200 max-w-2xl">
                Turn sentences into a focused quiz experience.  
                Learn not just words, but how they live inside real phrases.
              </p>
            </header>

            {/* Page title + subtitle */}
            <div className="mb-5 text-center">
              <h2 className="text-2xl font-semibold flex items-center justify-center gap-2">
                {page === "dashboard" && <span>üè†</span>}
                {page === "import" && <span>üì•</span>}
                {page === "practice" && <span>üéØ</span>}
                {page === "cloud" && <span>‚òÅÔ∏è</span>}
                <span>{pageTitle}</span>
              </h2>
              <p className="text-xs md:text-sm text-slate-300 mt-1">
                {pageSubtitle}
              </p>
            </div>

            {/* Pages */}
            <div className="relative min-h-[280px]">
              {renderDashboardPage()}
              {renderImportPage()}
              {renderPracticePage()}
              {renderCloudPage()}
            </div>
          </main>
        </div>
      );
    }

    ReactDOM.createRoot(document.getElementById("root")).render(<App />);
  </script>
</body>
</html>
